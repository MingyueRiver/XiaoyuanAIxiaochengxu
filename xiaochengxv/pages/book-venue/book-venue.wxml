<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-container">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input
        class="search-input"
        type="text"
        placeholder="æœç´¢åœºåœ°åç§°æˆ–ä½ç½®..."
        placeholder-class="search-placeholder"
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
      />
    </view>
  </view>

  <!-- ç­›é€‰é€‰é¡¹ -->
  <view class="filter-container">
    <scroll-view scroll-x class="filter-scroll">
      <view class="filter-group">
        <view
          class="filter-btn {{selectedFilters.type === 'all' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-type="type"
          data-value="all"
        >
          å…¨éƒ¨ç±»å‹
        </view>
        <view
          class="filter-btn {{selectedFilters.type === 'æ•™å®¤' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-type="type"
          data-value="æ•™å®¤"
        >
          æ•™å®¤
        </view>
        <view
          class="filter-btn {{selectedFilters.type === 'è®¨è®ºå®¤' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-type="type"
          data-value="è®¨è®ºå®¤"
        >
          è®¨è®ºå®¤
        </view>
        <view
          class="filter-btn {{selectedFilters.type === 'è¿åŠ¨åœº' ? 'active' : ''}}"
          bindtap="onFilterChange"
          data-type="type"
          data-value="è¿åŠ¨åœº"
        >
          è¿åŠ¨åœº
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½åœºåœ°ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:elif="{{isEmpty}}" class="empty-container">
    <text class="empty-icon">ğŸ“</text>
    <text class="empty-title">æš‚æ— å¯ç”¨åœºåœ°</text>
    <text class="empty-desc">è¯·ç¨å€™ï¼Œåœºåœ°ä¿¡æ¯åŠ è½½ä¸­...</text>
  </view>

  <!-- åœºåœ°åˆ—è¡¨ -->
  <scroll-view scroll-y class="venues-list">
    <view class="venue-card" wx:for="{{filteredVenues}}" wx:key="_id" bindtap="selectVenue" data-id="{{item._id}}">
      <!-- åœºåœ°å›¾ç‰‡ -->
      <image src="{{item.image || '/images/venue-default.png'}}" class="venue-image" mode="aspectFill"></image>

      <!-- åœºåœ°ä¿¡æ¯ -->
      <view class="venue-info">
        <view class="venue-header">
          <text class="venue-name">{{item.name}}</text>
          <text class="venue-type">{{item.type}}</text>
        </view>

        <text class="venue-location">ğŸ“ {{item.location}}</text>

        <view class="venue-meta">
          <text class="meta-item">ğŸ‘¥ {{item.capacity}}äºº</text>
          <text class="meta-item">â­ {{item.rating}} ({{item.reviews}})</text>
          <text class="price">Â¥{{item.pricePerHour}}/å°æ—¶</text>
        </view>

        <view class="facilities">
          <text wx:for="{{item.facilities}}" wx:key="*this" class="facility-tag">{{item}}</text>
        </view>

        <view class="venue-action">
          <button class="action-btn">ç«‹å³é¢„çº¦</button>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- é¢„çº¦è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay {{showVenueDetail ? 'show' : ''}}" bindtap="closeVenueDetail"></view>
  <view class="booking-modal {{showVenueDetail ? 'show' : ''}}">
    <view class="modal-header">
      <text class="modal-title">é¢„çº¦ {{selectedVenue.name}}</text>
      <text class="close-btn" bindtap="closeVenueDetail">âœ•</text>
    </view>

    <!-- é¢„çº¦è¡¨å• -->
    <scroll-view scroll-y class="modal-content">
      <!-- åœºåœ°ä¿¡æ¯æ‘˜è¦ -->
      <view class="booking-summary">
        <text class="summary-label">åœºåœ°ä¿¡æ¯</text>
        <view class="summary-item">
          <text class="label">ä½ç½®ï¼š</text>
          <text class="value">{{selectedVenue.location}}</text>
        </view>
        <view class="summary-item">
          <text class="label">å®¹é‡ï¼š</text>
          <text class="value">{{selectedVenue.capacity}} äºº</text>
        </view>
        <view class="summary-item">
          <text class="label">ä»·æ ¼ï¼š</text>
          <text class="value">Â¥{{selectedVenue.pricePerHour}}/å°æ—¶</text>
        </view>
      </view>

      <!-- é¢„çº¦æ—¥æœŸ -->
      <view class="form-section">
        <text class="form-label">é¢„çº¦æ—¥æœŸ</text>
        <picker mode="date" value="{{bookingDate}}" start="{{bookingDate}}" bindchange="onDateChange">
          <view class="picker-view">
            <text class="picker-text">{{bookingDate}}</text>
            <text class="picker-icon">â€º</text>
          </view>
        </picker>
      </view>

      <!-- å¼€å§‹æ—¶é—´ -->
      <view class="form-section">
        <text class="form-label">å¼€å§‹æ—¶é—´</text>
        <picker
          mode="selector"
          range="{{timeSlots}}"
          value="{{startTime}}"
          range-key="name"
          bindchange="onStartTimeChange"
        >
          <view class="picker-view">
            <text class="picker-text">{{startTime}}</text>
            <text class="picker-icon">â€º</text>
          </view>
        </picker>
      </view>

      <!-- ç»“æŸæ—¶é—´ -->
      <view class="form-section">
        <text class="form-label">ç»“æŸæ—¶é—´</text>
        <picker
          mode="selector"
          range="{{timeSlots}}"
          value="{{endTime}}"
          range-key="name"
          bindchange="onEndTimeChange"
        >
          <view class="picker-view">
            <text class="picker-text">{{endTime}}</text>
            <text class="picker-icon">â€º</text>
          </view>
        </picker>
      </view>

      <!-- å¤‡æ³¨ -->
      <view class="form-section">
        <text class="form-label">å¤‡æ³¨ä¿¡æ¯ (é€‰å¡«)</text>
        <textarea
          class="booking-textarea"
          placeholder="å¦‚æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œè¯·åœ¨æ­¤è¯´æ˜"
          placeholder-class="input-placeholder"
          maxlength="200"
          value="{{notes}}"
          bindinput="onNotesInput"
        />
      </view>

      <!-- è´¹ç”¨è®¡ç®— -->
      <view class="cost-summary">
        <view class="cost-row">
          <text class="cost-label">åœºåœ°ä»·æ ¼ï¼š</text>
          <text class="cost-value">Â¥{{selectedVenue.pricePerHour}}/å°æ—¶</text>
        </view>
        <view class="cost-row">
          <text class="cost-label">é¢„çº¦æ—¶é•¿ï¼š</text>
          <text class="cost-value">{{parseInt(endTime) - parseInt(startTime)}} å°æ—¶</text>
        </view>
        <view class="cost-divider"></view>
        <view class="cost-row total">
          <text class="cost-label">åˆè®¡è´¹ç”¨ï¼š</text>
          <text class="cost-value-total">Â¥{{calculateTotal()}}</text>
        </view>
      </view>

      <!-- æ³¨æ„äº‹é¡¹ -->
      <view class="tips-box">
        <text class="tips-title">é¢„çº¦é¡»çŸ¥</text>
        <text class="tips-text">â€¢ é¢„çº¦åï¼Œåœºåœ°ç®¡ç†å‘˜å°†åœ¨24å°æ—¶å†…ç¡®è®¤</text>
        <text class="tips-text">â€¢ å¦‚éœ€å–æ¶ˆï¼Œè¯·åœ¨é¢„çº¦æ—¶é—´å‰2å°æ—¶å–æ¶ˆ</text>
        <text class="tips-text">â€¢ è¯·æå‰15åˆ†é’Ÿåˆ°è¾¾åœºåœ°è¿›è¡Œç­¾åˆ°</text>
      </view>
    </scroll-view>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="closeVenueDetail">å–æ¶ˆ</button>
      <button class="btn-confirm {{isSubmitting ? 'disabled' : ''}}" bindtap="onSubmitBooking" disabled="{{isSubmitting}}">
        {{isSubmitting ? 'é¢„çº¦ä¸­...' : 'ç¡®è®¤é¢„çº¦'}}
      </button>
    </view>
  </view>
</view>
