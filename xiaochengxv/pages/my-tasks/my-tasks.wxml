<view class="container">
  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tab-bar">
    <view class="tab-item {{activeTab === 'posted' ? 'active' : ''}}" bindtap="switchTab" data-tab="posted">
      <text>å·²å‘å¸ƒ</text>
    </view>
    <view class="tab-item {{activeTab === 'accepted' ? 'active' : ''}}" bindtap="switchTab" data-tab="accepted">
      <text>è¿›è¡Œä¸­</text>
    </view>
    <view class="tab-item {{activeTab === 'completed' ? 'active' : ''}}" bindtap="switchTab" data-tab="completed">
      <text>å·²å®Œæˆ</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:elif="{{isEmpty}}" class="empty-container">
    <text class="empty-icon">ğŸ“‹</text>
    <text class="empty-title">è¿˜æ²¡æœ‰ä»»åŠ¡</text>
    <text class="empty-desc">å‘å¸ƒä»»åŠ¡è®©åˆ«äººå¸®ä½ å®Œæˆï¼Œæˆ–æ¥å—åˆ«äººçš„ä»»åŠ¡èµšå–æŠ¥é…¬</text>
    <button class="post-btn" bindtap="postNewTask">å‘å¸ƒç¬¬ä¸€ä¸ªä»»åŠ¡</button>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <view wx:else class="tasks-list">
    <view class="task-card" wx:for="{{filteredTasks}}" wx:key="_id">
      <!-- ä»»åŠ¡å¤´éƒ¨ -->
      <view class="task-header">
        <view class="task-title-section">
          <text class="task-title">{{item.title}}</text>
          <view class="task-badges">
            <text class="status-badge {{item.status === 'æ‹›å‹Ÿä¸­' ? 'recruiting' : item.status === 'è¿›è¡Œä¸­' ? 'ongoing' : 'completed'}}">{{item.status}}</text>
            <text class="urgency-badge {{item.urgency === 'high' ? 'high' : item.urgency === 'medium' ? 'medium' : 'low'}}">{{item.urgencyText}}</text>
          </view>
        </view>
        <text class="task-reward">Â¥{{item.reward}}</text>
      </view>

      <!-- ä»»åŠ¡æè¿° -->
      <view class="task-body">
        <text class="task-description">{{item.description}}</text>
        <view class="task-details">
          <view class="detail-item">
            <text class="detail-label">ğŸ“</text>
            <text class="detail-text">{{item.location}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">ğŸ“…</text>
            <text class="detail-text">æˆªæ­¢ {{item.deadline}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">ğŸ‘¥</text>
            <text class="detail-text">{{item.applicants}} äººæŠ¥å</text>
          </view>
        </view>
      </view>

      <!-- ä»»åŠ¡ä¿¡æ¯ -->
      <view class="task-info">
        <view class="info-left">
          <text class="post-date">å‘å¸ƒäº {{item.postDate}}</text>
          <text wx:if="{{item.acceptedBy}}" class="accepted-by">å·²ç”± {{item.acceptedBy}} æ¥å—</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="task-actions">
        <button class="action-btn detail-btn" bindtap="goToTaskDetail" data-id="{{item._id}}">è¯¦æƒ…</button>
        <button wx:if="{{item.status === 'æ‹›å‹Ÿä¸­'}}" class="action-btn edit-btn" bindtap="editTask" data-id="{{item._id}}">ç¼–è¾‘</button>
        <button wx:if="{{item.status === 'æ‹›å‹Ÿä¸­'}}" class="action-btn cancel-btn" bindtap="cancelTask" data-id="{{item._id}}">å–æ¶ˆ</button>
        <button wx:if="{{item.status === 'è¿›è¡Œä¸­'}}" class="action-btn complete-btn" bindtap="completeTask" data-id="{{item._id}}">å®Œæˆ</button>
      </view>
    </view>
  </view>

  <!-- å‘å¸ƒæ–°ä»»åŠ¡æµ®åŠ¨æŒ‰é’® -->
  <view wx:if="{{!isEmpty && !isLoading}}" class="fab-container">
    <button class="fab-button" bindtap="postNewTask">+</button>
  </view>
</view>
